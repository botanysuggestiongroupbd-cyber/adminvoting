<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Botany Suggestion Group - ‡¶ö‡¶§‡ßÅ‡¶∞‡ßç‡¶• ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶®</title>
    <script src="https://cdn.jsdelivr.net/npm/@fingerprintjs/fingerprintjs@3/dist/fp.min.js"></script>
    <style>
        /* ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ CSS ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤‡¶ó‡ßÅ‡¶≤‡ßã ‡¶è‡¶ï‡¶á ‡¶•‡¶æ‡¶ï‡¶¨‡ßá */
        body {
            font-family: 'SolaimanLipi', Arial, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .candidate-card {
            background: white;
            border: 2px solid #ddd;
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .candidate-card:hover {
            border-color: #4CAF50;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .candidate-card.selected {
            border-color: #4CAF50;
            background: linear-gradient(135deg, #E8F5E8, #C8E6C9);
        }
        .candidate-marker {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            color: white;
            flex-shrink: 0;
        }
        .candidate-info {
            flex-grow: 1;
        }
        .candidate-name {
            font-size: 18px;
            font-weight: bold;
            margin: 0;
            color: #333;
        }
        .vote-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 18px 40px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 20px;
            margin: 25px 0;
            font-weight: bold;
            transition: all 0.3s;
        }
        .vote-btn:hover:not(:disabled) {
            background: #45a049;
            transform: scale(1.05);
        }
        .vote-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        .voter-info {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin: 25px 0;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
            font-size: 16px;
        }
        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        .form-group input:focus {
            border-color: #4CAF50;
            outline: none;
        }
        .selected-candidates {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            padding: 25px;
            border-radius: 15px;
            margin: 25px 0;
            border: 3px solid #fdcb6e;
        }
        .selected-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            display: flex;
            align-items: center;
            gap: 15px;
            border-left: 5px solid #4CAF50;
        }
        .admin-section {
            background: #ffebee;
            padding: 20px;
            border-radius: 15px;
            margin: 25px 0;
            border: 3px solid #f44336;
        }
        .instructions {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            border-left: 5px solid #2196F3;
        }
        .counter {
            font-size: 14px;
            color: #666;
            margin-top: 10px;
        }
        .error-message {
            color: #f44336;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }
        .results-btn {
            background: #2196F3;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 18px;
            margin: 15px 10px;
            font-weight: bold;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }
        .results-btn:hover {
            background: #1976D2;
            transform: scale(1.05);
        }
        .voting-closed {
            background: linear-gradient(135deg, #ffebee, #ffcdd2);
            padding: 25px;
            border-radius: 15px;
            margin: 25px 0;
            border: 3px solid #f44336;
            text-align: center;
        }
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: 18px;
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- ‡¶≠‡ßã‡¶ü‡¶ø‡¶Ç ‡¶∏‡ßá‡¶ï‡¶∂‡¶® -->
        <div id="voting-section">
            <h1 style="text-align: center; color: #2c3e50; margin-bottom: 30px;">
                üåø Botany Suggestion Group Bangladesh - ‡¶ö‡¶§‡ßÅ‡¶∞‡ßç‡¶• ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶®
            </h1>
            
            <!-- Show Results Button - Always Visible -->
            <div style="text-align: center; margin: 20px 0;">
                <button class="results-btn" onclick="viewResultsPage()">
                    üìä ‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®
                </button>
            </div>

            <div class="instructions">
                <h3>üìã ‡¶≠‡ßã‡¶ü‡ßá‡¶∞ ‡¶®‡¶ø‡ßü‡¶Æ‡¶æ‡¶¨‡¶≤‡¶ø:</h3>
                <ul style="font-size: 16px; line-height: 1.6;">
                    <li>‚úÖ ‡¶Ü‡¶™‡¶®‡¶æ‡¶ï‡ßá <strong>‡¶†‡¶ø‡¶ï ‡ß® ‡¶ú‡¶® ‡¶™‡ßç‡¶∞‡¶æ‡¶∞‡ßç‡¶•‡ßÄ</strong>‡¶ï‡ßá ‡¶≠‡ßã‡¶ü ‡¶¶‡¶ø‡¶§‡ßá ‡¶π‡¶¨‡ßá (‡¶ï‡¶Æ ‡¶¨‡¶æ ‡¶¨‡ßá‡¶∂‡¶ø ‡¶®‡ßü)</li>
                    <li>‚úÖ ‡¶≠‡ßã‡¶ü‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ <strong>‡¶Ö‡¶¨‡¶∂‡ßç‡¶Ø‡¶á</strong> ‡¶¶‡¶ø‡¶§‡ßá ‡¶π‡¶¨‡ßá</li>
                    <li>‚úÖ ‡¶≠‡ßã‡¶ü ‡¶è‡¶ï‡¶¨‡¶æ‡¶∞‡¶á ‡¶¶‡¶ø‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®</li>
                    <li>‚úÖ ‡¶≠‡ßã‡¶ü ‡¶¶‡ßá‡¶ì‡ßü‡¶æ‡¶∞ ‡¶™‡¶∞ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ</li>
                </ul>
            </div>

            <!-- Voting Closed Message -->
            <div class="voting-closed" id="voting-closed-message" style="display: none;">
                <h3>‚õî ‡¶≠‡ßã‡¶ü‡¶ø‡¶Ç ‡¶¨‡¶®‡ßç‡¶ß</h3>
                <p>‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶™‡ßç‡¶∞‡¶ï‡¶æ‡¶∂‡¶ø‡¶§ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§ ‡¶è‡¶ñ‡¶® ‡¶Ü‡¶∞ ‡¶≠‡ßã‡¶ü ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ‡•§</p>
                <p>‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶â‡¶™‡¶∞‡ßá‡¶∞ "‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®" ‡¶¨‡¶æ‡¶ü‡¶®‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>
            </div>

            <!-- ‡¶≠‡ßã‡¶ü‡¶æ‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø -->
            <div class="voter-info" id="voter-info-section">
                <h3>üë§ ‡¶≠‡ßã‡¶ü‡¶æ‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø</h3>
                <div class="form-group">
                    <label for="voter-name">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ (‡¶Ö‡¶¨‡¶∂‡ßç‡¶Ø‡¶á ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®):</label>
                    <input type="text" id="voter-name" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®" maxlength="50">
                    <div id="name-error" class="error-message">‡¶®‡¶æ‡¶Æ ‡¶Ö‡¶¨‡¶∂‡ßç‡¶Ø‡¶á ‡¶¶‡¶ø‡¶§‡ßá ‡¶π‡¶¨‡ßá</div>
                </div>
            </div>

            <h3 style="text-align: center; color: #2c3e50; margin: 30px 0;" id="candidate-selection-title">üó≥Ô∏è ‡¶™‡ßç‡¶∞‡¶æ‡¶∞‡ßç‡¶•‡ßÄ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶® (‡¶†‡¶ø‡¶ï ‡ß® ‡¶ú‡¶®):</h3>
            
            <!-- Candidates List with Loading -->
            <div id="candidates-container">
                <div class="loading" id="candidates-loading">‡¶™‡ßç‡¶∞‡¶æ‡¶∞‡ßç‡¶•‡ßÄ‡¶¶‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>
                <div id="candidates-list" style="display: none;"></div>
            </div>

            <div class="selected-candidates" id="selected-candidates" style="display: none;">
                <h3>‚úÖ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶ø‡¶§ ‡¶™‡ßç‡¶∞‡¶æ‡¶∞‡ßç‡¶•‡ßÄ (‡ß® ‡¶ú‡¶®):</h3>
                <div id="selected-list"></div>
                <div class="counter" id="selection-counter">‡ß¶/‡ß® ‡¶ú‡¶® ‡¶™‡ßç‡¶∞‡¶æ‡¶∞‡ßç‡¶•‡ßÄ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶ø‡¶§</div>
            </div>

            <div style="text-align: center;">
                <button id="vote-btn" class="vote-btn" onclick="submitVote()" disabled>
                    ‡¶≠‡ßã‡¶ü ‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶® ‚úÖ
                </button>
            </div>
            
            <!-- Admin Section -->
            <div class="admin-section" id="admin-section" style="display: none;">
                <h3>üîß Admin Panel</h3>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button onclick="resetAllVotes()" style="background: #f44336; color: white; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer;">
                        ‡¶∏‡¶¨ ‡¶≠‡ßã‡¶ü ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®
                    </button>
                    <button onclick="viewResults()" style="background: #2196F3; color: white; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer;">
                        ‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®
                    </button>
                    <button onclick="clearLocalStorage()" style="background: #FF9800; color: white; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer;">
                        ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ ‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡ßá‡¶ú ‡¶ï‡ßç‡¶≤‡¶ø‡ßü‡¶æ‡¶∞
                    </button>
                </div>
                <div id="admin-results" style="margin-top: 20px;"></div>
            </div>
        </div>

        <!-- ‡¶≠‡ßã‡¶ü ‡¶¶‡ßá‡¶ì‡ßü‡¶æ‡¶∞ ‡¶™‡¶∞ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú -->
        <div id="after-vote" style="display: none; text-align: center; padding: 60px 20px;">
            <div style="background: white; padding: 40px; border-radius: 20px; box-shadow: 0 5px 25px rgba(0,0,0,0.1);">
                <div style="font-size: 80px; margin-bottom: 20px;">üéâ</div>
                <h2 style="color: #4CAF50; margin-bottom: 15px;">‡¶ß‡¶®‡ßç‡¶Ø‡¶¨‡¶æ‡¶¶! ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶≠‡ßã‡¶ü ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶ú‡¶Æ‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá</h2>
                <p style="font-size: 18px; color: #666; margin-bottom: 25px;">
                    <strong id="voter-thank"></strong>, ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø‡¶¨‡¶æ‡¶® ‡¶≠‡ßã‡¶ü‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ö‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø ‡¶ß‡¶®‡ßç‡¶Ø‡¶¨‡¶æ‡¶¶
                </p>
                <div id="vote-summary" style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 20px 0;"></div>
                <p style="color: #888;">‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶®‡ßá‡¶∞ ‡¶´‡¶≤‡¶æ‡¶´‡¶≤ Admin ‡¶¶‡ßç‡¶¨‡¶æ‡¶∞‡¶æ ‡¶ò‡ßã‡¶∑‡¶£‡¶æ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶¨‡ßá</p>
                
                <!-- Show Results Button in after vote section -->
                <button class="results-btn" onclick="viewResultsPage()">
                    üìä ‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®
                </button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, doc, getDoc, setDoc, deleteDoc, query, where, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyChDeqEPatoWTUPoZpcYOSXcnAuoVJsV-c",
            authDomain: "apps-login-page.firebaseapp.com",
            projectId: "apps-login-page",
            storageBucket: "apps-login-page.firebasestorage.app",
            messagingSenderId: "601656721972",
            appId: "1:601656721972:web:20ce6efffc82b2e0b68061",
            measurementId: "G-RPPBB0C7BQ"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // ‡¶™‡ßç‡¶∞‡¶æ‡¶∞‡ßç‡¶•‡ßÄ‡¶¶‡ßá‡¶∞ ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü with unique markers
        const candidates = [
            { id: 1, name: "Aoual Sheikh", marker: "üêï", color: "#e74c3c" },
            { id: 2, name: "Afrin Sultana", marker: "ü¶í", color: "#3498db" },
            { id: 3, name: "Amio Biswas", marker: "üêì", color: "#2ecc71" },
            { id: 4, name: "Amrita Rani", marker: "ü¶ö", color: "#f39c12" },
            { id: 5, name: "Ashik Khan", marker: "üêã", color: "#9b59b6" },
            { id: 6, name: "Fahmida Sultana", marker: "üê¨", color: "#1abc9c" },
            { id: 7, name: "Esrat Jahan Emi", marker: "ü™≥", color: "#d35400" },
            { id: 8, name: "Fazle", marker: "ü™∞", color: "#c0392b" },
            { id: 9, name: "Sabbir Hosain", marker: "ü¶ü", color: "#16a085" },
            { id: 10, name: "Mahmuda Akter Sumee", marker: "üï∑Ô∏è", color: "#8e44ad" },
            { id: 11, name: "Itz Amirul", marker: "ü¶ñ", color: "#27ae60" },
            { id: 12, name: "Kawsar Alam", marker: "ü¶â", color: "#e67e22" },
            { id: 13, name: "Kazi Nazmul Hasan", marker: "üê•", color: "#2980b9" },
            { id: 14, name: "Lamis Shikder", marker: "ü™∂", color: "#f1c40f" },
            { id: 15, name: "Md Joni Islam", marker: "üêò", color: "#e91e63" },
            { id: 16, name: "Md Samiul Alam", marker: "üêô", color: "#00bcd4" },
            { id: 17, name: "Misbah Akter Mithila", marker: "üê±", color: "#795548" },
            { id: 18, name: "Tanvir Hassan", marker: "ü¶ì", color: "#607d8b" },
            { id: 19, name: "Mohon Talukder", marker: "ü¶å", color: "#3f51b5" },
            { id: 20, name: "Moriam Mim", marker: "ü¶©", color: "#009688" },
            { id: 21, name: "Nasrin Akter Tarin", marker: "üåµ", color: "#ff5722" },
            { id: 22, name: "Priti Das", marker: "üåπ", color: "#673ab7" },
            { id: 23, name: "Rayhan Hossain Hridoy", marker: "üíê", color: "#ff9800" },
            { id: 24, name: "Riyad Hossain", marker: "ü¶≠", color: "#2196f3" },
            { id: 25, name: "Sadia Sultana", marker: "üêå", color: "#4caf50" },
            { id: 26, name: "Saifa Ahmed", marker: "üêù", color: "#ffeb3b" },
            { id: 27, name: "Sakil Khan", marker: "üåª", color: "#9c27b0" },
            { id: 28, name: "Sanjida Khan Koli", marker: "üêú", color: "#00bcd4" },
            { id: 29, name: "Sakila Simi", marker: "ü¶ã", color: "#ffc107" },
            { id: 30, name: "Shojeb Rana", marker: "ü¶Ö", color: "#8bc34a" },
            { id: 31, name: "Sujoy Sarker", marker: "ü¶ú", color: "#e91e63" },
            { id: 32, name: "Tanjina Akter", marker: "üê¥", color: "#3f51b5" },
            { id: 33, name: "Tasrin Akter Bristy", marker: "ü••", color: "#009688" },
            { id: 34, name: "Tayba Haider Riya", marker: "üçÖ", color: "#ff5722" },
            { id: 35, name: "Md Roman Molla", marker: "üå∂Ô∏è", color: "#795548" },
            { id: 36, name: "Md Sujon Shikder", marker: "üåΩ", color: "#607d8b" },
            { id: 37, name: "Sadek Mia", marker: "üçâ", color: "#f44336" },
            { id: 38, name: "Md Rana Ahmed", marker: "üçÑ", color: "#4caf50" },
            { id: 39, name: "Md Saidul Haque", marker: "ü•≠", color: "#2196f3" }
        ];

        const settingsDoc = doc(db, "settings", "election");
        let selectedCandidates = [];
        let deviceFingerprint = '';
        let hasVoted = false;
        let resultsPublished = false;

        // ‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶™‡ßç‡¶∞‡¶ï‡¶æ‡¶∂‡¶ø‡¶§ ‡¶ï‡¶ø‡¶®‡¶æ ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶æ
        async function checkResultsPublished() {
            try {
                const docSnap = await getDoc(settingsDoc);
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    resultsPublished = data.resultsPublished || false;
                    console.log("Results published status:", resultsPublished);
                    
                    if (resultsPublished) {
                        disableVoting();
                    } else {
                        enableVoting();
                    }
                } else {
                    resultsPublished = false;
                    enableVoting();
                }
            } catch (error) {
                console.error("Error checking results status:", error);
                resultsPublished = false;
                enableVoting();
            }
        }

        // ‡¶≠‡ßã‡¶ü‡¶ø‡¶Ç ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡¶æ
        function disableVoting() {
            document.getElementById('voting-closed-message').style.display = 'block';
            document.getElementById('voter-info-section').style.display = 'none';
            document.getElementById('candidate-selection-title').style.display = 'none';
            document.getElementById('candidates-container').style.display = 'none';
            document.getElementById('selected-candidates').style.display = 'none';
            document.getElementById('vote-btn').style.display = 'none';
            
            // ‡¶≠‡ßã‡¶ü ‡¶¨‡¶æ‡¶ü‡¶® ‡¶°‡¶ø‡¶∏‡ßá‡¶¨‡¶≤ ‡¶ï‡¶∞‡ßÅ‡¶®
            document.getElementById('vote-btn').disabled = true;
        }

        // ‡¶≠‡ßã‡¶ü‡¶ø‡¶Ç ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶ï‡¶∞‡¶æ
        function enableVoting() {
            document.getElementById('voting-closed-message').style.display = 'none';
            document.getElementById('voter-info-section').style.display = 'block';
            document.getElementById('candidate-selection-title').style.display = 'block';
            document.getElementById('candidates-container').style.display = 'block';
            document.getElementById('vote-btn').style.display = 'block';
        }

        // ar.html ‡¶™‡ßá‡¶ú‡ßá ‡¶∞‡¶ø‡¶°‡¶æ‡¶á‡¶∞‡ßá‡¶ï‡ßç‡¶ü
        window.viewResultsPage = function() {
            window.location.href = 'ar.html';
        }

        // ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏ ‡¶´‡¶ø‡¶ô‡ßç‡¶ó‡¶æ‡¶∞‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü ‡¶ú‡ßá‡¶®‡¶æ‡¶∞‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ
        async function generateFingerprint() {
            try {
                const fp = await FingerprintJS.load();
                const result = await fp.get();
                return result.visitorId;
            } catch (error) {
                console.error('‡¶´‡¶ø‡¶ô‡ßç‡¶ó‡¶æ‡¶∞‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü Error:', error);
                return 'device_' + Math.random().toString(36).substr(2, 9);
            }
        }

        // ‡¶™‡ßç‡¶∞‡¶æ‡¶∞‡ßç‡¶•‡ßÄ‡¶¶‡ßá‡¶∞ ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã - FIXED VERSION
        function displayCandidates() {
            console.log("Displaying candidates...");
            const container = document.getElementById('candidates-list');
            const loading = document.getElementById('candidates-loading');
            
            if (!container) {
                console.error("Candidates list container not found!");
                return;
            }
            
            try {
                // ‡¶≤‡ßã‡¶°‡¶ø‡¶Ç ‡¶π‡¶æ‡¶á‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®
                loading.style.display = 'none';
                container.style.display = 'block';
                container.innerHTML = '';
                
                console.log("Total candidates:", candidates.length);
                
                candidates.forEach(candidate => {
                    const card = document.createElement('div');
                    card.className = 'candidate-card';
                    card.innerHTML = `
                        <div class="candidate-marker" style="background: ${candidate.color}">
                            ${candidate.marker}
                        </div>
                        <div class="candidate-info">
                            <div class="candidate-name">${candidate.name}</div>
                            <div style="color: #666; font-size: 14px;">‡¶Æ‡¶æ‡¶∞‡ßç‡¶ï‡¶æ: ${candidate.marker}</div>
                        </div>
                    `;
                    
                    card.onclick = () => toggleCandidate(candidate, card);
                    container.appendChild(card);
                });
                
                console.log("Candidates displayed successfully");
            } catch (error) {
                console.error("Error displaying candidates:", error);
                container.innerHTML = '<div class="loading">‡¶™‡ßç‡¶∞‡¶æ‡¶∞‡ßç‡¶•‡ßÄ‡¶¶‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§ ‡¶™‡ßÉ‡¶∑‡ßç‡¶†‡¶æ‡¶ü‡¶ø ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</div>';
            }
        }

        // ‡¶™‡ßç‡¶∞‡¶æ‡¶∞‡ßç‡¶•‡ßÄ ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü/‡¶°‡¶ø‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü
        function toggleCandidate(candidate, card) {
            if (hasVoted) {
                alert('‡¶Ü‡¶™‡¶®‡¶ø ‡¶á‡¶§‡¶ø‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶≠‡ßã‡¶ü ‡¶¶‡¶ø‡ßü‡ßá‡¶õ‡ßá‡¶®!');
                return;
            }

            if (resultsPublished) {
                alert('‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶™‡ßç‡¶∞‡¶ï‡¶æ‡¶∂‡¶ø‡¶§ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§ ‡¶è‡¶ñ‡¶® ‡¶Ü‡¶∞ ‡¶≠‡ßã‡¶ü ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ‡•§');
                return;
            }
            
            const index = selectedCandidates.findIndex(c => c.id === candidate.id);
            
            if (index === -1) {
                if (selectedCandidates.length < 2) {
                    selectedCandidates.push(candidate);
                    card.classList.add('selected');
                } else {
                    alert('‡¶Ü‡¶™‡¶®‡¶ø ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡ß® ‡¶ú‡¶® ‡¶™‡ßç‡¶∞‡¶æ‡¶∞‡ßç‡¶•‡ßÄ‡¶ï‡ßá ‡¶≠‡ßã‡¶ü ‡¶¶‡¶ø‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®‡•§ ‡¶Ü‡¶∞‡ßá‡¶ï‡¶ú‡¶® ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶Ü‡¶ó‡ßá ‡¶è‡¶ï‡¶ú‡¶® ‡¶°‡¶ø‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
                    return;
                }
            } else {
                selectedCandidates.splice(index, 1);
                card.classList.remove('selected');
            }
            
            updateSelectedList();
            updateVoteButton();
        }

        // ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü‡ßá‡¶° ‡¶™‡ßç‡¶∞‡¶æ‡¶∞‡ßç‡¶•‡ßÄ‡¶¶‡ßá‡¶∞ ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
        function updateSelectedList() {
            const container = document.getElementById('selected-list');
            const section = document.getElementById('selected-candidates');
            const counter = document.getElementById('selection-counter');
            
            if (selectedCandidates.length > 0) {
                section.style.display = 'block';
                container.innerHTML = selectedCandidates.map(candidate => `
                    <div class="selected-item">
                        <div class="candidate-marker" style="background: ${candidate.color}">
                            ${candidate.marker}
                        </div>
                        <div>
                            <strong>${candidate.name}</strong>
                            <div style="color: #666; font-size: 14px;">‡¶Æ‡¶æ‡¶∞‡ßç‡¶ï‡¶æ: ${candidate.marker}</div>
                        </div>
                    </div>
                `).join('');
                
                counter.textContent = `${selectedCandidates.length}/‡ß® ‡¶ú‡¶® ‡¶™‡ßç‡¶∞‡¶æ‡¶∞‡ßç‡¶•‡ßÄ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶ø‡¶§`;
                counter.style.color = selectedCandidates.length === 2 ? '#4CAF50' : '#f39c12';
                counter.style.fontWeight = selectedCandidates.length === 2 ? 'bold' : 'normal';
            } else {
                section.style.display = 'none';
            }
        }

        // ‡¶≠‡ßã‡¶ü ‡¶¨‡¶æ‡¶ü‡¶® ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
        function updateVoteButton() {
            const voteBtn = document.getElementById('vote-btn');
            const voterName = document.getElementById('voter-name').value.trim();
            const nameError = document.getElementById('name-error');
            
            // ‡¶®‡¶æ‡¶Æ ‡¶≠‡ßç‡¶Ø‡¶æ‡¶≤‡¶ø‡¶°‡ßá‡¶∂‡¶®
            if (voterName === '') {
                nameError.style.display = 'block';
            } else {
                nameError.style.display = 'none';
            }
            
            // ‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶™‡ßç‡¶∞‡¶ï‡¶æ‡¶∂‡¶ø‡¶§ ‡¶π‡¶≤‡ßá ‡¶≠‡ßã‡¶ü ‡¶¨‡¶®‡ßç‡¶ß
            if (resultsPublished) {
                voteBtn.disabled = true;
                voteBtn.textContent = '‚õî ‡¶≠‡ßã‡¶ü‡¶ø‡¶Ç ‡¶¨‡¶®‡ßç‡¶ß';
                return;
            }
            
            // ‡¶¨‡¶æ‡¶ü‡¶® ‡¶è‡¶®‡¶æ‡¶¨‡¶≤/‡¶°‡¶ø‡¶∏‡ßá‡¶¨‡¶≤
            const canVote = selectedCandidates.length === 2 && voterName !== '' && !hasVoted;
            voteBtn.disabled = !canVote;
        }

        // ‡¶≠‡ßã‡¶ü ‡¶ú‡¶Æ‡¶æ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ
        window.submitVote = async function() {
            const voterName = document.getElementById('voter-name').value.trim();
            
            // ‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶™‡ßç‡¶∞‡¶ï‡¶æ‡¶∂‡¶ø‡¶§ ‡¶π‡¶≤‡ßá ‡¶≠‡ßã‡¶ü ‡¶¨‡¶®‡ßç‡¶ß
            if (resultsPublished) {
                alert('‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶™‡ßç‡¶∞‡¶ï‡¶æ‡¶∂‡¶ø‡¶§ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§ ‡¶è‡¶ñ‡¶® ‡¶Ü‡¶∞ ‡¶≠‡ßã‡¶ü ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ‡•§');
                return;
            }
            
            // ‡¶≠‡ßç‡¶Ø‡¶æ‡¶≤‡¶ø‡¶°‡ßá‡¶∂‡¶®
            if (voterName === '') {
                alert('‡¶¶‡ßü‡¶æ ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®');
                document.getElementById('voter-name').focus();
                return;
            }
            
            if (selectedCandidates.length !== 2) {
                alert('‡¶¶‡ßü‡¶æ ‡¶ï‡¶∞‡ßá ‡¶†‡¶ø‡¶ï ‡ß® ‡¶ú‡¶® ‡¶™‡ßç‡¶∞‡¶æ‡¶∞‡ßç‡¶•‡ßÄ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®');
                return;
            }

            if (hasVoted) {
                alert('‡¶Ü‡¶™‡¶®‡¶ø ‡¶á‡¶§‡¶ø‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶≠‡ßã‡¶ü ‡¶¶‡¶ø‡ßü‡ßá‡¶õ‡ßá‡¶®!');
                return;
            }

            try {
                // ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏ ‡¶´‡¶ø‡¶ô‡ßç‡¶ó‡¶æ‡¶∞‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü
                const fingerprint = await generateFingerprint();
                deviceFingerprint = fingerprint;

                // Firestore-‡¶è ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶æ
                const votesQuery = query(collection(db, "votes"), where("fingerprint", "==", fingerprint));
                const querySnapshot = await getDocs(votesQuery);
                
                if (!querySnapshot.empty) {
                    alert('‡¶è‡¶á ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏ ‡¶•‡ßá‡¶ï‡ßá ‡¶á‡¶§‡¶ø‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶≠‡ßã‡¶ü ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
                    hasVoted = true;
                    updateVoteButton();
                    return;
                }

                // ‡¶≠‡ßã‡¶ü ‡¶°‡¶æ‡¶ü‡¶æ
                const voteData = {
                    voterName: voterName,
                    candidate1: selectedCandidates[0].name,
                    candidate1_marker: selectedCandidates[0].marker,
                    candidate2: selectedCandidates[1].name,
                    candidate2_marker: selectedCandidates[1].marker,
                    fingerprint: fingerprint,
                    timestamp: new Date(),
                    userAgent: navigator.userAgent,
                    ipAddress: await getIPAddress()
                };

                // Firestore-‡¶è ‡¶∏‡ßá‡¶≠
                await addDoc(collection(db, "votes"), voteData);
                
                // ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ ‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡ßá‡¶ú
                localStorage.setItem('hasVoted', 'true');
                localStorage.setItem('voteFingerprint', fingerprint);
                localStorage.setItem('voteTime', new Date().toISOString());
                localStorage.setItem('voterName', voterName);
                
                hasVoted = true;
                showAfterVote(voterName);
                
            } catch (error) {
                console.error('‡¶≠‡ßã‡¶ü Error:', error);
                alert('‡¶≠‡ßã‡¶ü ‡¶ú‡¶Æ‡¶æ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ‡¶∞ ‡¶∏‡¶Æ‡ßü ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá: ' + error.message);
            }
        }

        // IP ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡ßç‡¶∞‡ßá‡¶∏
        async function getIPAddress() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                return data.ip;
            } catch (error) {
                return 'unknown';
            }
        }

        // ‡¶≠‡ßã‡¶ü ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶ö‡ßá‡¶ï - FIXED VERSION
        async function checkVoteStatus() {
            try {
                const fingerprint = await generateFingerprint();
                deviceFingerprint = fingerprint;
                
                // ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá Firebase ‡¶•‡ßá‡¶ï‡ßá ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®
                const votesQuery = query(collection(db, "votes"), where("fingerprint", "==", fingerprint));
                const querySnapshot = await getDocs(votesQuery);
                
                if (!querySnapshot.empty) {
                    // Firebase-‡¶è ‡¶≠‡ßã‡¶ü ‡¶Ü‡¶õ‡ßá
                    hasVoted = true;
                    localStorage.setItem('hasVoted', 'true');
                    const voteData = querySnapshot.docs[0].data();
                    showAfterVote(voteData.voterName);
                } else {
                    // Firebase-‡¶è ‡¶≠‡ßã‡¶ü ‡¶®‡ßá‡¶á, ‡¶ï‡¶ø‡¶®‡ßç‡¶§‡ßÅ Local Storage-‡¶è ‡¶Ü‡¶õ‡ßá
                    const localVote = localStorage.getItem('hasVoted');
                    if (localVote === 'true') {
                        // Local Storage ‡¶è‡¶¨‡¶Ç Firebase‰∏ç‰∏ÄËá¥ - Local Storage ‡¶ï‡ßç‡¶≤‡¶ø‡ßü‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®
                        console.log("Clearing inconsistent local storage...");
                        clearLocalVoteStorage();
                    }
                    hasVoted = false;
                    showVotingSection();
                }
            } catch (error) {
                console.error('Status check error:', error);
                // Error ‡¶π‡¶≤‡ßá Local Storage ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®
                const localVote = localStorage.getItem('hasVoted');
                if (localVote === 'true') {
                    hasVoted = true;
                    const savedName = localStorage.getItem('voterName') || '‡¶≠‡ßã‡¶ü‡¶æ‡¶∞';
                    showAfterVote(savedName);
                } else {
                    showVotingSection();
                }
            }
        }

        // Local Storage ‡¶ï‡ßç‡¶≤‡¶ø‡ßü‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
        function clearLocalVoteStorage() {
            localStorage.removeItem('hasVoted');
            localStorage.removeItem('voteFingerprint');
            localStorage.removeItem('voteTime');
            localStorage.removeItem('voterName');
        }

        // ‡¶≠‡ßã‡¶ü ‡¶¶‡ßá‡¶ì‡ßü‡¶æ‡¶∞ ‡¶™‡¶∞‡ßá‡¶∞ ‡¶≠‡¶ø‡¶â
        function showAfterVote(voterName) {
            document.getElementById('voting-section').style.display = 'none';
            document.getElementById('after-vote').style.display = 'block';
            document.getElementById('voter-thank').textContent = voterName;
            
            // ‡¶≠‡ßã‡¶ü ‡¶∏‡¶æ‡¶Æ‡¶æ‡¶∞‡¶ø
            const summary = document.getElementById('vote-summary');
            summary.innerHTML = `
                <h4 style="margin-bottom: 15px; color: #333;">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶≠‡ßã‡¶ü:</h4>
                ${selectedCandidates.map(candidate => `
                    <div style="display: flex; align-items: center; gap: 10px; margin: 10px 0; padding: 10px; background: white; border-radius: 8px;">
                        <div class="candidate-marker" style="background: ${candidate.color}; width: 40px; height: 40px; font-size: 16px;">
                            ${candidate.marker}
                        </div>
                        <div>
                            <strong>${candidate.name}</strong>
                            <div style="color: #666; font-size: 14px;">‡¶Æ‡¶æ‡¶∞‡ßç‡¶ï‡¶æ: ${candidate.marker}</div>
                        </div>
                    </div>
                `).join('')}
            `;
        }

        // Admin ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®‡¶ó‡ßÅ‡¶≤‡ßã
        window.resetAllVotes = async function() {
            if (!confirm('‚ö†Ô∏è ‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶Ø‡ßá ‡¶∏‡¶¨ ‡¶≠‡ßã‡¶ü ‡¶°‡¶ø‡¶≤‡ßá‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®? ‡¶è‡¶ü‡¶ø ‡¶∞‡¶ø‡¶≠‡¶æ‡¶∞‡ßç‡¶∏‡¶ø‡¶¨‡¶≤ ‡¶®‡ßü!')) {
                return;
            }

            if (!confirm('‚ùå FINAL WARNING: ‡¶∏‡¶¨ ‡¶≠‡ßã‡¶ü ‡¶è‡¶¨‡¶Ç Local Storage ‡¶°‡¶æ‡¶ü‡¶æ ‡¶°‡¶ø‡¶≤‡ßá‡¶ü ‡¶π‡¶¨‡ßá!')) {
                return;
            }

            try {
                // Firebase ‡¶≠‡ßã‡¶ü ‡¶°‡¶ø‡¶≤‡ßá‡¶ü
                const querySnapshot = await getDocs(collection(db, "votes"));
                const deletePromises = [];
                querySnapshot.forEach((doc) => {
                    deletePromises.push(deleteDoc(doc.ref));
                });
                await Promise.all(deletePromises);
                
                // Settings ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü
                await setDoc(settingsDoc, { 
                    resultsPublished: false,
                    lastUpdated: new Date().toISOString(),
                    resetBy: 'admin',
                    totalCandidates: 39
                }, { merge: true });
                
                // Local Storage ‡¶ï‡ßç‡¶≤‡¶ø‡ßü‡¶æ‡¶∞
                clearLocalVoteStorage();
                
                alert('‚úÖ ‡¶∏‡¶¨ ‡¶≠‡ßã‡¶ü ‡¶è‡¶¨‡¶Ç ‡¶°‡¶æ‡¶ü‡¶æ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
                location.reload(); // ‡¶™‡ßá‡¶ú ‡¶∞‡¶ø‡¶≤‡ßã‡¶°
                
            } catch (error) {
                alert('‚ùå ‡¶≠‡ßã‡¶ü ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ: ' + error.message);
            }
        }

        window.viewResults = async function() {
            try {
                const querySnapshot = await getDocs(collection(db, "votes"));
                const votes = [];
                querySnapshot.forEach((doc) => {
                    votes.push(doc.data());
                });

                const voteCount = {};
                candidates.forEach(candidate => {
                    voteCount[candidate.name] = 0;
                });

                votes.forEach(vote => {
                    if (vote.candidate1) voteCount[vote.candidate1]++;
                    if (vote.candidate2) voteCount[vote.candidate2]++;
                });

                const sortedResults = Object.entries(voteCount)
                    .sort(([,a], [,b]) => b - a);

                const resultsContainer = document.getElementById('admin-results');
                resultsContainer.innerHTML = `
                    <h4>‡¶Æ‡ßã‡¶ü ‡¶≠‡ßã‡¶ü: ${votes.length}</h4>
                    ${sortedResults.map(([candidate, count]) => {
                        const candidateInfo = candidates.find(c => c.name === candidate);
                        return `
                            <div style="padding: 10px; border-bottom: 1px solid #ddd; background: white; margin: 8px 0; border-radius: 8px; display: flex; align-items: center; gap: 15px;">
                                <div class="candidate-marker" style="background: ${candidateInfo?.color || '#666'}; width: 35px; height: 35px; font-size: 14px;">
                                    ${candidateInfo?.marker || '?'}
                                </div>
                                <div style="flex-grow: 1;">
                                    <strong>${candidate}</strong>
                                    <div style="color: #666; font-size: 14px;">‡¶Æ‡¶æ‡¶∞‡ßç‡¶ï‡¶æ: ${candidateInfo?.marker || 'N/A'}</div>
                                </div>
                                <div style="font-weight: bold; color: #2c3e50; font-size: 18px;">${count}</div>
                            </div>
                        `;
                    }).join('')}
                `;
            } catch (error) {
                alert('‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ: ' + error.message);
            }
        }

        window.clearLocalStorage = function() {
            clearLocalVoteStorage();
            alert('‚úÖ ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ ‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡ßá‡¶ú ‡¶ï‡ßç‡¶≤‡¶ø‡ßü‡¶æ‡¶∞ ‡¶π‡ßü‡ßá‡¶õ‡ßá!');
            location.reload();
        }

        // Settings real-time listener
        function setupSettingsListener() {
            onSnapshot(settingsDoc, (doc) => {
                if (doc.exists()) {
                    const data = doc.data();
                    resultsPublished = data.resultsPublished || false;
                    console.log("Settings updated, resultsPublished:", resultsPublished);
                    
                    if (resultsPublished) {
                        disableVoting();
                    } else {
                        enableVoting();
                    }
                    updateVoteButton();
                }
            });

            // Votes real-time listener - ‡¶Ø‡¶¶‡¶ø ‡¶ï‡ßá‡¶â Admin Panel ‡¶•‡ßá‡¶ï‡ßá ‡¶≠‡ßã‡¶ü ‡¶°‡¶ø‡¶≤‡ßá‡¶ü ‡¶ï‡¶∞‡ßá
            onSnapshot(collection(db, "votes"), (snapshot) => {
                snapshot.docChanges().forEach((change) => {
                    if (change.type === "removed") {
                        // ‡¶Ø‡¶¶‡¶ø ‡¶≠‡ßã‡¶ü ‡¶°‡¶ø‡¶≤‡ßá‡¶ü ‡¶π‡ßü, Local Storage ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®
                        const localVote = localStorage.getItem('hasVoted');
                        const localFingerprint = localStorage.getItem('voteFingerprint');
                        
                        if (localVote === 'true' && localFingerprint === change.doc.data().fingerprint) {
                            console.log("Vote was deleted from Firebase, clearing local storage...");
                            clearLocalVoteStorage();
                            hasVoted = false;
                            showVotingSection();
                        }
                    }
                });
            });
        }

        // ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü ‡¶≤‡¶ø‡¶∏‡ßá‡¶®‡¶æ‡¶∞
        document.getElementById('voter-name').addEventListener('input', updateVoteButton);

        // UI ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® - FIXED VERSION
        function showVotingSection() {
            console.log("Showing voting section...");
            document.getElementById('voting-section').style.display = 'block';
            document.getElementById('after-vote').style.display = 'none';
            
            // ‡¶™‡ßç‡¶∞‡¶æ‡¶∞‡ßç‡¶•‡ßÄ‡¶¶‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®
            displayCandidates();
            updateVoteButton();
            
            console.log("Voting section displayed");
        }

        function checkAdminAccess() {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('admin') === 'true') {
                document.getElementById('admin-section').style.display = 'block';
            }
        }

        // ‡¶™‡ßá‡¶ú ‡¶≤‡ßã‡¶° - FIXED VERSION
        window.onload = async function() {
            console.log("Page loaded, initializing...");
            await checkResultsPublished();
            setupSettingsListener();
            await checkVoteStatus();
            checkAdminAccess();
            console.log("Initialization complete");
        }
    </script>
</body>
</html>
